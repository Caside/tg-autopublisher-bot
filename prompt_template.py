"""
Этот файл содержит шаблон промпта для генерации постов с помощью DeepSeek API.
Реализована автономная генерация без использования предопределенных списков.
"""

from themes import POST_THEMES

# Список форматов для постов (сохраняем для обратной совместимости)
POST_FORMATS = [
    "когнитивное откровение в стиле твита",
    "псевдонаучное объяснение внутреннего конфликта",
    "молчаливая манифестация экзистенциальной тревоги",
    "сравнение философского вопроса с бытовой ситуацией",
    "культурный нейро-факт с непрошенным выводом",
    "внутренний монолог цифрового шамана",
    "мини-сценка в духе чёрного зеркала",
    "поэтическая декомпозиция абсурдной идеи",
    "утопический прогноз, который выглядит как сатира",
    "краткий инструктаж по выживанию в ментальной симуляции",
    "диалог между архетипами (например, Тень и Эго)",
    "разрушение иллюзии через бытовой пример",
    "история из будущего, в которой всё пошло не так",
    "обращение от лица алгоритма к своему пользователю",
    "сенсорное описание абстрактного понятия",
    "мысленный эксперимент с катастрофическим результатом",
    "ироничная переписка с подсознанием",
    "бессмысленная инструкция, в которой проявляется смысл",
    "сравнение человеческого поведения с багом в коде",
    "циничный афоризм в псевдо-коучинговом тоне"
]

# Список вариантов завершения постов (сохраняем для обратной совместимости)
POST_ENDINGS = [
    "завершить эффектом недосказанности",
    "завершить внутренним парадоксом без комментариев",
    "завершить неожиданной сменой тона",
    "завершить как будто это был сон",
    "завершить фразой, которую читатель не сможет забыть (и не поймёт почему)",
    "завершить поддельной уверенностью в абсурдной истине",
    "завершить цитатой, которую никто не сможет найти",
    "завершить пафосом на грани неловкости",
    "завершить так, будто это был тизер к продолжению",
    "завершить указанием на банальность, от которой хочется плакать",
    "завершить иллюзией глубокого смысла",
    "завершить будто это последняя строчка письма самому себе из прошлого",
    "завершить обрывом мысли на пике напряжения",
    "завершить ультралаконично, как будто всё сказано одним словом",
    "завершить ощущением, что читатель что-то упустил",
    "завершить как будто речь идёт совсем не о том, о чём был текст",
    "завершить намёком на несуществующую концепцию",
    "завершить так, будто текст не должен был быть опубликован",
    "завершить шёпотом, который слышен в голове",
    "завершить мета-комментарием, ломающим четвёртую стену"
]

# Шаблон для генерации промпта (обратная совместимость)
DEEPSEEK_PROMPT = """
Сгенерируй пост для публикации в телеграм-канале на тему {theme}.
Пост должен быть в формате: {format}.

Длина: 450-500 символов.

Важные инструкции:
- Используй разговорный, но культурный стиль
- Избегай банальных фраз и избитых выражений
- Будь оригинальным, не повторяй шаблонные мысли
- Предложи идею, которую можно применить
- Включи элемент неожиданности или новой перспективы
- Для форматирования ИСПОЛЬЗУЙ ТОЛЬКО СЛЕДУЮЩИЕ HTML-теги, поддерживаемые Telegram:
  - <b>жирный текст</b> - для заголовков и важных утверждений
  - <i>курсив</i> - для ключевых терминов и акцентов
  - Не используй теги <emoji>, <br>, и другие сложные HTML-теги, они не будут отображаться
  - Не используй сложные emoji в тексте, только базовые emoji
- {ending}

ВАЖНО: В канале ОТКЛЮЧЕНЫ комментарии, поэтому НЕ ПРИЗЫВАЙ к обсуждению, комментированию, 
и не задавай вопросы предполагающие ответ в комментариях.
"""

# Шаблон для мета-генерации промпта
META_GENERATION_PROMPT = """
Сгенерируй уникальные параметры для создания поста в телеграм-канале.

СЛУЧАЙНЫЙ ЭЛЕМЕНТ: {random_element}

1. Выбери ОДНУ тему из следующего списка, используя следующий алгоритм:
    - Возьми текущее время в миллисекундах
    - Раздели его на количество тем в списке (21)
    - Остаток от деления (0-20) определит номер темы в списке
    
    Список тем (пронумерованный):
    0. мудрость
    1. современная проблематика
    2. психология
    3. философия
    4. социология
    5. искусственный интеллект
    6. нейрофизиология
    7. когнитивистика
    8. магия
    9. информационная экология
    10. цифровая этика
    11. футурология
    12. поведенческая экономика
    13. теория игр
    14. лингвистика
    15. системное мышление
    16. этика
    17. метапознание
    18. городской шаманизм
    19. архетипы
    20. символизм повседневности
    
    ВАЖНО: 
    - Используй ТОЛЬКО указанный алгоритм для выбора темы
    - НЕ выбирай тему на основе её "интересности" или "подходящести"
    - Каждая тема должна иметь равную вероятность выбора
    
2. Создай оригинальный формат для подачи информации, который 
    будет выделяться и привлекать внимание.
    
    ВАЖНО:
    - Избегай форматов, которые использовались в предыдущих запросах
    - Каждый новый формат должен быть существенно отличным от предыдущих
    
3. Предложи неочевидный способ завершения поста, который 
    оставит читателя с ощущением инсайта.

4. Добавь дополнительные инструкции для создания поста 
    (стилистические приемы, особенности тона, необычный угол зрения).

Верни результат в формате JSON:
{
    "theme": "выбранная по алгоритму тема",
    "format": "оригинальный формат подачи",
    "ending": "способ завершения поста",
    "additional_instructions": {
        "tone": "описание тона",
        "style": "описание стиля",
        "unusual_angle": "описание необычного угла зрения"
    }
}

ВАЖНО:
1. Верни ТОЛЬКО валидный JSON, без дополнительных символов или комментариев
2. Не используй переносы строк в значениях полей
3. Не используй операторы конкатенации строк (+)
4. Все значения должны быть строками в двойных кавычках
5. Не добавляй никаких других полей в JSON
6. Не добавляй никаких комментариев после JSON
"""

# Шаблон для генерации поста на основе мета-промпта
POST_GENERATION_PROMPT = """
Сгенерируй пост для публикации в телеграм-канале на тему {theme}.
Пост должен быть в формате: {format}.

Длина: 450-600 символов.

Важные инструкции:
- Используй разговорный, но культурный стиль
- Избегай банальных фраз и избитых выражений
- Будь оригинальным, не повторяй шаблонные мысли
- Предложи идею, которую можно применить
- Включи элемент неожиданности или новой перспективы
- Для форматирования ИСПОЛЬЗУЙ ТОЛЬКО СЛЕДУЮЩИЕ HTML-теги, поддерживаемые Telegram:
  - <b>жирный текст</b> - для заголовков и важных утверждений
  - <i>курсив</i> - для ключевых терминов и акцентов
  - Не используй теги <emoji>, <br>, и другие сложные HTML-теги, они не будут отображаться
  - Не используй сложные emoji в тексте, только базовые emoji
- {ending}
- {additional_instructions}

ВАЖНО: В канале ОТКЛЮЧЕНЫ комментарии, поэтому НЕ ПРИЗЫВАЙ к обсуждению, комментированию, 
и не задавай вопросы предполагающие ответ в комментариях.
"""

# Параметры для API запроса
DEEPSEEK_API_PARAMS = {
    "model": "deepseek-chat",  # Можно заменить на другую модель DeepSeek
    "temperature": 0.9,        # Умеренная температура для баланса между разнообразием и качеством
    "max_tokens": 600,         # Максимальная длина ответа
    "top_p": 0.95,             # Параметр для разнообразия
    "stream": False,           # Не использовать потоковую передачу для ответа
    "presence_penalty": 0.8,   # Штраф за повторение уже использованных токенов
    "frequency_penalty": 0.8,  # Штраф за повторение часто используемых токенов
    "top_k": 40,              # Параметр для разнообразия
    "seed": None              # Отключаем фиксированный seed для обеспечения случайности
}
